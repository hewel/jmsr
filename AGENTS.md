# AGENTS.md

Tauri v2 desktop app: Jellyfin MPV Shim rewrite. External MPV player controller via JSON IPC.

## Stack

- **Frontend**: Solid.js + TypeScript + Rsbuild + TanStack Query + TanStack Form
- **Backend**: Rust (Tauri v2) with tauri-specta for type-safe bindings
- **Tools**: Bun, Biome (lint/format), Rstest (jsdom)

## Structure

```
jmsr/
├── src/              # Solid.js frontend
│   ├── index.tsx     # Entry point
│   ├── App.tsx       # Root component
│   └── bindings.ts   # AUTO-GENERATED by tauri-specta (DO NOT EDIT)
├── src-tauri/        # Rust backend (see src-tauri/AGENTS.md)
├── tests/            # Rstest tests with @testing-library
└── doc/PRD.md        # Product requirements
```

## Where to Look

| Task | Location | Notes |
|------|----------|-------|
| Add Tauri command | `src-tauri/src/command.rs` | Decorate with `#[tauri::command]` + `#[specta]` |
| Register command | `src-tauri/src/lib.rs` | Add to `collect_commands![]` |
| Frontend component | `src/` | Solid.js (NOT React) |
| Call Rust from TS | `src/bindings.ts` | Import `commands.*`, auto-generated |
| Add test | `tests/*.test.ts` | Uses Rstest + testing-library |

## Commands

```bash
bun run dev          # Start Rsbuild dev server (port 3000)
bun run build        # Production build → dist/
bun run test         # Rstest
bun run test:watch   # Rstest watch mode
bun run check        # Biome check + autofix
bun run format       # Biome format

# Tauri (run from project root)
bunx tauri dev       # Dev mode with hot reload
bunx tauri build     # Production desktop build
```

## Conventions

- **Single quotes** in JS/TS (biome.json)
- **2-space indent** in Rust (rustfmt.toml: `tab_spaces = 2`)
- **Type-safe IPC**: All Rust↔TS via tauri-specta, never raw `invoke()`
- **NO libmpv embed**: MPV spawned as external process, controlled via JSON IPC
- **Solid.js reactivity**: Use `createSignal`, `createResource`, NOT React hooks
- **Forms**: Always use `@tanstack/solid-form` with `createForm` for form handling

## Anti-Patterns

- **`bindings.ts` edits**: Auto-generated, changes will be overwritten on build
- **React patterns in Solid**: No `useState`, `useEffect` – use Solid primitives
- **Raw Tauri invoke**: Always use typed `commands.*` from bindings

## Docs

- Rsbuild: https://rsbuild.rs/llms.txt
- Rspack: https://rspack.rs/llms.txt
- Rstest: https://rstest.rs/llms.txt
- Tauri v2: https://v2.tauri.app
- tauri-specta: https://github.com/oscartbeaumont/tauri-specta
- Solid.js: https://www.solidjs.com

## Notes

- PRD at `doc/PRD.md` defines architecture: Sentinel (Tauri GUI) → Bridge (IPC) → Player (external mpv)
- Rust backend exports bindings to `src/bindings.ts` on debug builds only
- Test setup extends expect with jest-dom matchers (rstest.setup.ts)
- See `doc/todos.md` for current tasks and priorities
